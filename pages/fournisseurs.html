<!-- Page Fournisseurs - Gestion compl√®te -->
<div class="page-header">
    <div class="breadcrumb">
        <a href="#" onclick="App.loadPage('dashboard')">Accueil</a>
        <span class="separator">/</span>
        <span>Fournisseurs</span>
    </div>
    <div class="d-flex justify-content-between align-items-center">
        <h2>Gestion des Fournisseurs</h2>
        <div class="d-flex gap-2">
            <button class="btn btn-secondary" onclick="App.exportToCSV('fournisseurs')">
                <span>üì•</span> Exporter
            </button>
            <button class="btn btn-primary" onclick="openFournisseurModal()">
                <span>‚ûï</span> Nouveau Fournisseur
            </button>
        </div>
    </div>
</div>

<!-- Filtres -->
<div class="card mb-3">
    <div class="card-body">
        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 16px; align-items: end;">
            <div class="form-group">
                <label class="form-label">Rechercher</label>
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" placeholder="Nom, IFU, t√©l√©phone..." id="searchFournisseurs">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Cat√©gorie</label>
                <select class="form-control" id="filterCategorie">
                    <option value="">Toutes</option>
                    <option value="fournitures">Fournitures</option>
                    <option value="services">Services</option>
                    <option value="travaux">Travaux</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Statut</label>
                <select class="form-control" id="filterStatutFournisseur">
                    <option value="">Tous</option>
                    <option value="Actif">Actif</option>
                    <option value="Suspendu">Suspendu</option>
                    <option value="Blacklist√©">Blacklist√©</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Note min.</label>
                <select class="form-control" id="filterNote">
                    <option value="">Toutes</option>
                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê et +</option>
                    <option value="3">‚≠ê‚≠ê‚≠ê et +</option>
                    <option value="2">‚≠ê‚≠ê et +</option>
                </select>
            </div>
            
            <button class="btn btn-outline" onclick="resetFournisseurFilters()">
                <span>üîÑ</span> R√©initialiser
            </button>
        </div>
    </div>
</div>

<!-- Tableau -->
<div class="card">
    <div class="card-body">
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Raison Sociale</th>
                        <th>IFU</th>
                        <th>Capital</th>
                        <th>T√©l√©phone</th>
                        <th>Email</th>
                        <th>Cat√©gories</th>
                        <th>Note</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="fournisseursTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal Fournisseur avec onglets -->
<div class="modal" id="fournisseurModal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h3 class="modal-title">Nouveau Fournisseur</h3>
            <button class="modal-close" onclick="closeFournisseurModal()">&times;</button>
        </div>
        
        <div class="modal-body">
            <!-- Onglets -->
            <div class="tabs">
                <button class="tab active" onclick="showFournisseurTab('infos')">Informations</button>
                <button class="tab" onclick="showFournisseurTab('contacts')">Contacts</button>
                <button class="tab" onclick="showFournisseurTab('activites')">Activit√©s</button>
                <button class="tab" onclick="showFournisseurTab('conditions')">Conditions</button>
                <button class="tab" onclick="showFournisseurTab('documents')">Documents</button>
            </div>
            
            <form id="fournisseurForm">
                <!-- Onglet Informations -->
                <div id="infos-tab" class="tab-content active">
                    <h4>Informations l√©gales</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label class="form-label">Code Fournisseur</label>
                            <input type="text" class="form-control" id="codeFournisseur" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Raison Sociale <span class="required">*</span></label>
                            <input type="text" class="form-control" name="raisonSociale" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">IFU <span class="required">*</span></label>
                            <input type="text" class="form-control" name="ifu" pattern="CI\d{10}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">RCCM</label>
                            <input type="text" class="form-control" name="rccm">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Capital Social (FCFA)</label>
                            <input type="number" class="form-control" name="capital" min="1000000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Forme Juridique</label>
                            <select class="form-control" name="formeJuridique">
                                <option value="SARL">SARL</option>
                                <option value="SA">SA</option>
                                <option value="SAS">SAS</option>
                                <option value="EI">Entreprise Individuelle</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Onglet Contacts -->
                <div id="contacts-tab" class="tab-content">
                    <h4>Coordonn√©es</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label class="form-label">T√©l√©phone Principal <span class="required">*</span></label>
                            <input type="tel" class="form-control" name="telephone" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">T√©l√©phone Secondaire</label>
                            <input type="tel" class="form-control" name="telephoneSecondaire">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email Principal <span class="required">*</span></label>
                            <input type="email" class="form-control" name="email" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email Secondaire</label>
                            <input type="email" class="form-control" name="emailSecondaire">
                        </div>
                        <div class="form-group" style="grid-column: span 2;">
                            <label class="form-label">Adresse <span class="required">*</span></label>
                            <input type="text" class="form-control" name="adresse" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ville <span class="required">*</span></label>
                            <input type="text" class="form-control" name="ville" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Code Postal</label>
                            <input type="text" class="form-control" name="codePostal">
                        </div>
                    </div>
                </div>
                
                <!-- Autres onglets similaires -->
            </form>
        </div>
        
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeFournisseurModal()">Annuler</button>
            <button class="btn btn-primary" onclick="saveFournisseur()">Enregistrer</button>
        </div>
    </div>
</div>

<script>
function loadFournisseursTable() {
    const fournisseurs = db.tables.fournisseurs;
    const tbody = document.getElementById('fournisseursTableBody');
    
    tbody.innerHTML = fournisseurs.map(f => `
        <tr>
            <td><strong>${f.codeFournisseur}</strong></td>
            <td>${f.raisonSociale}</td>
            <td>${f.ifu}</td>
            <td>${App.formatMoney(f.capital || 0)}</td>
            <td>${f.telephone}</td>
            <td>${f.email}</td>
            <td>${f.categories ? f.categories.join(', ') : '-'}</td>
            <td>${'‚≠ê'.repeat(Math.floor(f.noteEvaluation || 0))}</td>
            <td><span class="badge badge-${f.statut === 'Actif' ? 'success' : 'warning'}">${f.statut}</span></td>
            <td>
                <div class="table-actions">
                    <button class="btn btn-sm btn-info" onclick="viewFournisseur('${f.id}')">üëÅÔ∏è</button>
                    <button class="btn btn-sm btn-secondary" onclick="editFournisseur('${f.id}')">‚úèÔ∏è</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteFournisseur('${f.id}')">üóëÔ∏è</button>
                </div>
            </td>
        </tr>
    `).join('');
}

function openFournisseurModal() {
    document.getElementById('codeFournisseur').value = 'F' + String(db.tables.fournisseurs.length + 1).padStart(3, '0');
    document.getElementById('fournisseurModal').classList.add('active');
}

function closeFournisseurModal() {
    document.getElementById('fournisseurModal').classList.remove('active');
}

function showFournisseurTab(tab) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.getElementById(tab + '-tab').classList.add('active');
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
}
</script>